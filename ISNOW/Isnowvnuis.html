<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>VNU-IS | ISNOW Christmas Gala 2025 - Guest Check-in</title>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

  <style>
    :root{
      --vnu-red:#8B1538;
      --vnu-gold:#D4AF37;
      --vnu-dark:#1a3a5c;
      --card-radius:22px;
      --shadow:0 20px 70px rgba(0,0,0,0.45);
      --muted:#6b7280;
      --border:#e5e7eb;
      --glass: rgba(255,255,255,0.14);
    }

    *{margin:0;padding:0;box-sizing:border-box}
    body{
      font-family: ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";
      background: url('https://i.imgur.com/6JZq9Xh.jpeg') center/cover no-repeat fixed;
      min-height:100vh;
      color:#111827;
      overflow-x:hidden;
      position:relative;
    }

    /* Aurora + sparkle overlay */
    body::before{
      content:"";
      position:fixed; inset:0;
      background:
        radial-gradient(900px 700px at 15% 20%, rgba(212,175,55,0.18), transparent 55%),
        radial-gradient(900px 700px at 80% 25%, rgba(139,21,56,0.22), transparent 60%),
        radial-gradient(900px 700px at 60% 85%, rgba(26,58,92,0.20), transparent 55%),
        linear-gradient(135deg, rgba(0,0,0,0.10), rgba(0,0,0,0.35));
      backdrop-filter: blur(2px);
      z-index:0;
    }
    body::after{
      content:"";
      position:fixed; inset:-20%;
      background:
        radial-gradient(circle at 12% 18%, rgba(255,255,255,0.25) 0 1px, transparent 2px),
        radial-gradient(circle at 28% 62%, rgba(255,255,255,0.20) 0 1px, transparent 2px),
        radial-gradient(circle at 55% 30%, rgba(255,255,255,0.22) 0 1px, transparent 2px),
        radial-gradient(circle at 78% 70%, rgba(255,255,255,0.18) 0 1px, transparent 2px),
        radial-gradient(circle at 90% 20%, rgba(255,255,255,0.16) 0 1px, transparent 2px);
      opacity:0.55;
      animation: twinkle 7s ease-in-out infinite;
      z-index:0;
      pointer-events:none;
    }
    @keyframes twinkle{
      0%,100%{ transform: translate3d(0,0,0) scale(1); opacity:.40; }
      50%{ transform: translate3d(-1.5%,1%,0) scale(1.02); opacity:.75; }
    }

    /* Snowflakes (emoji) */
    .snowflake{
      position:fixed; top:-24px;
      font-size:18px;
      animation: fall linear infinite;
      pointer-events:none;
      z-index:1;
      filter: drop-shadow(0 2px 10px rgba(0,0,0,0.25));
      user-select:none;
    }
    @keyframes fall{
      to{ transform: translateY(112vh) rotate(360deg); }
    }

    /* Soft floating bokeh */
    .bokeh{
      position:fixed;
      width:14px;height:14px;
      border-radius:50%;
      background: rgba(255,255,255,0.25);
      filter: blur(0.2px);
      opacity:0.35;
      z-index:1;
      animation: bokehMove linear infinite;
      pointer-events:none;
    }
    @keyframes bokehMove{
      from{ transform: translateY(110vh) translateX(0) scale(0.9); opacity:0; }
      10%{ opacity:0.35; }
      to{ transform: translateY(-20vh) translateX(40px) scale(1.2); opacity:0; }
    }

    /* Header */
    .header{
      position:fixed; top:0; left:0; right:0;
      padding:16px 18px;
      display:flex;
      align-items:center;
      justify-content:center;
      z-index:10;
      background: linear-gradient(to bottom, rgba(0,0,0,0.32), transparent);
      backdrop-filter: blur(10px);
    }
    .header-inner{
      width:min(1020px, 100%);
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      padding:10px 14px;
      border-radius:18px;
      background: rgba(255,255,255,0.06);
      border: 1px solid rgba(255,255,255,0.18);
      box-shadow: 0 10px 30px rgba(0,0,0,0.22);
    }
    .header-left{
      display:flex; align-items:center; gap:12px;
      min-width: 260px;
    }
    .brand-logo{
      height:48px; width:auto; display:block;
      filter: drop-shadow(0 3px 14px rgba(0,0,0,0.35));
    }
    .header-title{
      color:white; line-height:1.2;
    }
    .header-title .main{
      font-weight:900; font-size:14px; letter-spacing:.5px;
      text-shadow: 0 2px 10px rgba(0,0,0,0.35);
    }
    .header-title .sub{
      font-size:12px; opacity:.92;
      text-shadow: 0 2px 10px rgba(0,0,0,0.3);
    }

    /* Lucky badge in header (next to logo) */
    .header-lucky{
      display:flex;
      align-items:center;
      gap:10px;
      padding:10px 12px;
      border-radius:16px;
      background: linear-gradient(135deg, rgba(255,255,255,0.12), rgba(255,255,255,0.06));
      border: 1px solid rgba(255,255,255,0.22);
      color: #fff;
      box-shadow: inset 0 1px 0 rgba(255,255,255,0.15);
    }
    .header-lucky .label{
      font-size:11px;
      font-weight:900;
      letter-spacing:1px;
      text-transform:uppercase;
      opacity:.95;
    }
    .header-lucky .value{
      font-size:18px;
      font-weight:1000;
      letter-spacing:1px;
      padding:6px 10px;
      border-radius:12px;
      background: linear-gradient(135deg, rgba(212,175,55,0.95), rgba(139,21,56,0.85));
      box-shadow: 0 10px 22px rgba(0,0,0,0.22);
      min-width:64px;
      text-align:center;
    }
    .value.pulse{
      animation: pulseLucky 1.4s ease-in-out 2;
    }
    @keyframes pulseLucky{
      0%,100%{ transform: scale(1); filter: brightness(1); }
      50%{ transform: scale(1.08); filter: brightness(1.15); }
    }

    /* Layout */
    .main-container{
      min-height:100vh;
      display:flex; align-items:center; justify-content:center;
      padding:118px 16px 40px;
      position:relative; z-index:2;
    }

    .card-base{
      width:100%;
      max-width:720px;
      background: rgba(255,255,255,0.98);
      border-radius: var(--card-radius);
      box-shadow: var(--shadow), 0 0 120px rgba(212,175,55,0.18), inset 0 1px 0 rgba(255,255,255,0.95);
      padding:40px;
      text-align:center;
      border: 1px solid rgba(255,255,255,0.55);
      position:relative;
      overflow:hidden;
      animation: fadeIn .65s ease-out;
    }
    .card-base::before{
      content:"";
      position:absolute;
      inset:-50%;
      background:
        radial-gradient(circle at 30% 20%, rgba(212,175,55,0.18), transparent 40%),
        radial-gradient(circle at 70% 80%, rgba(139,21,56,0.12), transparent 42%),
        radial-gradient(circle at 35% 75%, rgba(59,130,246,0.10), transparent 45%);
      transform: rotate(8deg);
      z-index:0;
      animation: floatBg 9s ease-in-out infinite;
      pointer-events:none;
    }
    @keyframes floatBg{
      0%,100%{ transform: rotate(8deg) translate3d(0,0,0); opacity:0.9; }
      50%{ transform: rotate(8deg) translate3d(-1.2%,1.2%,0); opacity:1; }
    }
    @keyframes fadeIn{
      from{ opacity:0; transform: translateY(18px); }
      to{ opacity:1; transform: translateY(0); }
    }

    h2{
      color: var(--vnu-dark);
      margin-bottom: 12px;
      font-size: 30px;
      font-weight: 1000;
      position:relative;
      z-index:1;
      letter-spacing:.2px;
    }
    .lead{
      color: var(--muted);
      margin: 12px auto 26px;
      line-height: 1.65;
      max-width: 580px;
      font-size: 15.5px;
      position:relative;
      z-index:1;
    }

    .badge{
      display:inline-flex; gap:10px;
      align-items:center; justify-content:center;
      font-weight:900;
      color:var(--vnu-red);
      background: linear-gradient(135deg, #fff7ed, #ffedd5);
      border: 2px solid #fed7aa;
      border-radius: 999px;
      padding: 10px 18px;
      font-size: 13px;
      margin-bottom: 16px;
      box-shadow: 0 6px 18px rgba(212,175,55,0.22);
      position:relative;
      z-index:1;
      animation: badgeGlow 2.8s ease-in-out infinite;
    }
    @keyframes badgeGlow{
      0%,100%{ transform: scale(1); }
      50%{ transform: scale(1.03); }
    }

    .logo-big{
      height:120px;
      margin:0 auto 18px;
      display:block;
      filter: drop-shadow(0 8px 26px rgba(0,0,0,0.28));
      position:relative;
      z-index:1;
      animation: logoFloat 3.2s ease-in-out infinite;
    }
    @keyframes logoFloat{
      0%,100%{ transform: translateY(0); }
      50%{ transform: translateY(-10px); }
    }

    /* Form */
    .form{
      text-align:left;
      display:grid;
      gap:16px;
      position:relative;
      z-index:1;
    }
    label{
      font-weight:800;
      font-size:13.5px;
      color:#374151;
      margin-bottom:7px;
      display:block;
    }
    input{
      width:100%;
      padding:13px 14px;
      border:2px solid var(--border);
      border-radius:12px;
      font-size:15px;
      outline:none;
      background:#fff;
      transition: .2s;
    }
    input:focus{
      border-color: rgba(139,21,56,0.55);
      box-shadow: 0 0 0 4px rgba(139,21,56,0.10);
    }
    .row{
      display:grid;
      grid-template-columns:1fr 1fr;
      gap:14px;
    }
    @media (max-width:560px){
      .row{ grid-template-columns:1fr; }
      .card-base{ padding:30px; }
      .header-left{ min-width:unset; }
    }

    /* Buttons */
    .btn{
      border:none;
      border-radius:12px;
      padding:14px 18px;
      font-weight:900;
      cursor:pointer;
      letter-spacing:.7px;
      text-transform:uppercase;
      font-size:12.5px;
      display:inline-flex;
      align-items:center;
      justify-content:center;
      gap:10px;
      white-space:nowrap;
      transition: transform .18s ease, filter .18s ease, box-shadow .18s ease;
      user-select:none;
    }
    .btn-primary{
      background: linear-gradient(135deg, var(--vnu-gold), #b8952d);
      color:white;
      width:100%;
      box-shadow: 0 10px 26px rgba(212,175,55,0.28);
    }
    .btn-primary:hover{
      transform: translateY(-2px);
      filter: brightness(1.06);
      box-shadow: 0 14px 34px rgba(212,175,55,0.35);
    }
    .btn-secondary{
      background:#f3f4f6;
      color:#111827;
      border:2px solid #e5e7eb;
      width:100%;
    }
    .btn-secondary:hover{
      transform: translateY(-2px);
      filter: brightness(0.98);
    }

    /* Card (result) */
    .xmas-card{
      border: 12px solid rgba(212,175,55,0.98);
      text-align:left;
      box-shadow: 0 28px 80px rgba(0,0,0,0.45), 0 0 120px rgba(212,175,55,0.18);
    }

    .result-grid{
      display:grid;
      grid-template-columns:1fr 1fr;
      gap:12px;
      font-size:14px;
      color:#111827;
      margin-top:10px;
    }
    .result-item{
      padding:12px 12px;
      border:1px solid rgba(0,0,0,0.06);
      border-radius:12px;
      background: rgba(255,247,237,0.75);
    }
    .result-item b{
      color: var(--vnu-dark);
      display:block;
      margin-bottom:4px;
      font-size:12px;
      letter-spacing:.4px;
      text-transform:uppercase;
    }

    .card-actions{
      margin-top:18px;
      display:flex;
      gap:12px;
    }
    .card-actions .btn{ flex:1; }

    .hidden{ display:none!important; }

    /* Toast */
    .toast{
      position:fixed;
      top:104px;
      left:50%;
      transform: translateX(-50%);
      color:white;
      padding:14px 22px;
      border-radius:12px;
      font-weight:1000;
      font-size:13px;
      z-index:9999;
      box-shadow: 0 14px 34px rgba(0,0,0,0.25);
      animation: toastIn .25s ease-out;
    }
    @keyframes toastIn{
      from{ opacity:0; transform: translateX(-50%) translateY(-10px); }
      to{ opacity:1; transform: translateX(-50%) translateY(0); }
    }
    .toast.info{ background:linear-gradient(135deg,#3b82f6,#2563eb); }
    .toast.warn{ background:linear-gradient(135deg,#f59e0b,#d97706); }
    .toast.ok{ background:linear-gradient(135deg,#10b981,#059669); }

    /* Confetti */
    .confetti{
      position:fixed;
      top:-10px;
      width:10px;
      height:16px;
      border-radius:3px;
      opacity:0.9;
      z-index:9998;
      pointer-events:none;
      animation: confettiFall linear forwards;
      filter: drop-shadow(0 6px 10px rgba(0,0,0,0.15));
    }
    @keyframes confettiFall{
      to{ transform: translateY(110vh) rotate(720deg); opacity:0; }
    }
  </style>
</head>

<body>
  <div class="header">
    <div class="header-inner">
      <div class="header-left">
        <img
          src="https://www.is.vnu.edu.vn/wp-content/uploads/2022/04/icon_negative_yellow_text-08-539x600.png"
          alt="VNU-IS Logo"
          class="brand-logo"
        />
        <div class="header-lucky" title="Lucky number for mini game">
          <div class="label">üéü Lucky #</div>
          <div class="value" id="headerLucky">--</div>
        </div>
      </div>

      <div class="header-title" style="text-align:center;">
        <div class="main">VNU-IS | ISNOW Christmas Gala 2025</div>
        <div class="sub">Guest Check-in ‚Ä¢ Invitation Card ‚Ä¢ Mini Game Lucky Draw</div>
      </div>

      <div style="min-width:260px;"></div>
    </div>
  </div>

  <div class="main-container">
    <!-- Welcome -->
    <div id="welcomeScreen" class="card-base">
      <div class="badge">üéÑ Welcome ‚Ä¢ Check-in Required ‚Ä¢ Good Luck! ‚ú®</div>
      <img
        src="https://www.is.vnu.edu.vn/wp-content/uploads/2022/04/icon_negative_yellow_text-08-539x600.png"
        alt="Logo"
        class="logo-big"
      />
      <h2 style="color: var(--vnu-red);">Christmas Gala 2025</h2>
      <p class="lead">
        Please check in to generate your invitation card.
        After successful check-in, you will receive a <b>Lucky Number</b> for the mini game lucky draw.
      </p>
      <button class="btn btn-primary" onclick="navigateTo('formScreen')">‚ú® Begin Check-in ‚ú®</button>
    </div>

    <!-- Form -->
    <div id="formScreen" class="card-base hidden">
      <h2>Guest Registration</h2>
      <p class="lead">
        Please enter your details accurately. Your information will be submitted directly to Google Form and saved to your Google Sheet.
      </p>

      <form id="checkinForm" class="form" onsubmit="handleCheckin(event)">
        <div>
          <label for="email">Email (required)</label>
          <input type="email" id="email" placeholder="guest@example.com" required />
        </div>

        <div>
          <label for="fullname">Full Name</label>
          <input type="text" id="fullname" placeholder="Nguyen Van A" required />
        </div>

        <div class="row">
          <div>
            <label for="classname">Class / Department</label>
            <input type="text" id="classname" placeholder="MIS K24" required />
          </div>

          <div>
            <label for="country">Nationality</label>
            <input type="text" id="country" placeholder="Vietnam" required />
          </div>
        </div>

        <button type="submit" class="btn btn-primary">üéâ Check-in & Get Lucky Number üéâ</button>
        <button type="button" class="btn btn-secondary" onclick="navigateTo('welcomeScreen')">‚Üê Back</button>
      </form>
    </div>

    <!-- Card -->
    <div id="cardScreen" class="card-base xmas-card hidden">
      <div id="cardContent" style="position:relative;z-index:1;">
        <h2 style="color: var(--vnu-red); margin-bottom:8px;">Merry Christmas!</h2>
        <p class="lead" id="cardMessage"></p>

        <div class="result-grid">
          <div class="result-item"><b>Guest</b><span id="resName"></span></div>
          <div class="result-item"><b>Class</b><span id="resClass"></span></div>
          <div class="result-item"><b>Nationality</b><span id="resCountry"></span></div>
          <div class="result-item"><b>Check-in Time</b><span id="resTime"></span></div>
          <div class="result-item"><b>Email</b><span id="resEmail"></span></div>
          <div class="result-item"><b>Lucky Number</b><span id="resLucky" style="font-weight:1000;font-size:18px;"></span></div>
        </div>

        <div class="card-actions">
          <button class="btn btn-primary" type="button" onclick="saveAsPicture()">üíæ Save Picture</button>
          <button class="btn btn-secondary" type="button" onclick="doneAndReset()">‚úì Done</button>
        </div>
      </div>
    </div>
  </div>

  <script>
    // ‚úÖ Your Web App URL (/exec)
    const APPS_SCRIPT_WEB_APP_URL = "https://script.google.com/macros/s/AKfycbwrx53n4LR7PmRkhVu2rrpUaO9aPh7F99BpFnhFwQkQfIt5qAnhwnCZ8-yqMwzVClbL/exec";

    // --- Christmas scene (snow + bokeh) ---
    (function createSnow(){
      const emojis = ["‚ùÑÔ∏è","‚ùÑÔ∏è","‚õÑ","üéÑ","üéÖ","ü¶å","üîî","‚≠ê","üéÅ"];
      const count = 42;
      for(let i=0;i<count;i++){
        const s = document.createElement("div");
        s.className = "snowflake";
        s.textContent = emojis[Math.floor(Math.random()*emojis.length)];
        s.style.left = (Math.random()*100) + "vw";
        s.style.animationDuration = (Math.random()*5 + 6) + "s";
        s.style.opacity = (Math.random()*0.65 + 0.25).toFixed(2);
        s.style.fontSize = (Math.random()*14 + 14) + "px";
        s.style.animationDelay = (Math.random()*6) + "s";
        document.body.appendChild(s);
      }
    })();

    (function createBokeh(){
      const count = 18;
      for(let i=0;i<count;i++){
        const b = document.createElement("div");
        b.className = "bokeh";
        b.style.left = (Math.random()*100) + "vw";
        b.style.bottom = (-20 - Math.random()*60) + "vh";
        b.style.width = b.style.height = (Math.random()*12 + 8) + "px";
        b.style.opacity = (Math.random()*0.25 + 0.12).toFixed(2);
        b.style.animationDuration = (Math.random()*10 + 12) + "s";
        b.style.animationDelay = (Math.random()*7) + "s";
        document.body.appendChild(b);
      }
    })();

    // --- UI helpers ---
    function navigateTo(screenId){
      document.querySelectorAll(".card-base").forEach(s=>s.classList.add("hidden"));
      document.getElementById(screenId).classList.remove("hidden");
      if(screenId==="formScreen") document.getElementById("email").focus();
    }

    function doneAndReset(){
      // Keep lucky number in header until next guest starts
      navigateTo("welcomeScreen");
      // optional: clear header lucky after a moment
      setTimeout(()=> setHeaderLucky("--", false), 1200);
    }

    function toast(message, type="info", ms=2800){
      const n = document.createElement("div");
      n.className = `toast ${type}`;
      n.textContent = message;
      document.body.appendChild(n);
      setTimeout(()=> n.remove(), ms);
    }

    function pad3(n){
      return String(n).padStart(3, "0");
    }

    // Lucky number: 001 - 999
    function generateLuckyNumber(){
      return pad3(Math.floor(Math.random() * 999) + 1);
    }

    function setHeaderLucky(val, animate=true){
      const el = document.getElementById("headerLucky");
      el.textContent = val;
      el.classList.remove("pulse");
      if(animate){
        // reflow suggests animation restart
        void el.offsetWidth;
        el.classList.add("pulse");
      }
    }

    // Confetti burst (lightweight)
    function confettiBurst(){
      const pieces = 40;
      const colors = [
        "rgba(212,175,55,0.95)",
        "rgba(139,21,56,0.92)",
        "rgba(59,130,246,0.90)",
        "rgba(16,185,129,0.88)",
        "rgba(255,255,255,0.90)"
      ];
      for(let i=0;i<pieces;i++){
        const c = document.createElement("div");
        c.className = "confetti";
        c.style.left = (Math.random()*100) + "vw";
        c.style.background = colors[Math.floor(Math.random()*colors.length)];
        c.style.width = (Math.random()*8 + 6) + "px";
        c.style.height = (Math.random()*14 + 10) + "px";
        c.style.animationDuration = (Math.random()*1.6 + 1.9) + "s";
        c.style.transform = `translateY(0) rotate(${Math.random()*180}deg)`;
        document.body.appendChild(c);
        setTimeout(()=> c.remove(), 3500);
      }
    }

    // --- Send to Apps Script ---
    async function sendToGoogleFormViaScript(guest){
      const params = new URLSearchParams();
      params.append("email", guest.email);
      params.append("fullname", guest.name);
      params.append("classname", guest.className);
      params.append("country", guest.country);
      params.append("time", guest.time);
      params.append("luckynumber", guest.luckyNumber);

      const res = await fetch(APPS_SCRIPT_WEB_APP_URL, { method: "POST", body: params });
      const data = await res.json().catch(()=> ({}));
      if (!data.ok) throw new Error(data.error || "Submit failed");
      return data;
    }

    // --- Check-in ---
    async function handleCheckin(e){
      e.preventDefault();

      const guest = {
        email: document.getElementById("email").value.trim(),
        name: document.getElementById("fullname").value.trim(),
        className: document.getElementById("classname").value.trim(),
        country: document.getElementById("country").value.trim(),
        time: new Date().toLocaleString("en-GB"),
        luckyNumber: generateLuckyNumber()
      };

      try {
        await sendToGoogleFormViaScript(guest);
        toast("‚úì Check-in successful ‚Äî saved to Google Sheet!", "ok", 2400);
      } catch (err) {
        console.error(err);
        toast("‚ö†Ô∏è " + err.message, "warn", 3800);
        return;
      }

      // Update header lucky (next to logo)
      setHeaderLucky(guest.luckyNumber, true);

      // Confetti celebration
      confettiBurst();

      // Render card
      document.getElementById("resEmail").innerText = guest.email;
      document.getElementById("resName").innerText = guest.name;
      document.getElementById("resClass").innerText = guest.className;
      document.getElementById("resCountry").innerText = guest.country;
      document.getElementById("resTime").innerText = guest.time;
      document.getElementById("resLucky").innerText = guest.luckyNumber;

      const greetings = [
        `Dear ${guest.name}, welcome to the ISNOW Christmas Gala 2025! Wishing you a joyful evening and great luck in the lucky draw. üéÑ`,
        `Hello ${guest.name}! Thank you for joining us tonight. Enjoy the gala, mini games, and good luck! ‚ú®`,
        `Welcome, ${guest.name}! We‚Äôre delighted to have you with us. Merry Christmas and have an amazing time! üéÖ`,
        `Hi ${guest.name}! Your lucky number is ready‚Äîenjoy the celebration and good luck in the prize draw! üéÅ`,
        `Dear ${guest.name}, may your night be filled with laughter, friendship, and festive magic. Good luck! üîî`
      ];
      document.getElementById("cardMessage").innerText =
        greetings[Math.floor(Math.random() * greetings.length)];

      document.getElementById("checkinForm").reset();
      navigateTo("cardScreen");
    }

    // --- Save as picture ---
    async function saveAsPicture(){
      const cardElement = document.getElementById("cardContent");
      try{
        const canvas = await html2canvas(cardElement, { backgroundColor:"#ffffff", scale:2, useCORS:true });
        canvas.toBlob(function(blob) {
          const url = URL.createObjectURL(blob);
          const a = document.createElement("a");
          a.href = url;
          a.download = `ISNOW_2025_${Date.now()}.png`;
          a.click();
          URL.revokeObjectURL(url);
          toast("‚úì Card saved as picture!", "info", 2200);
        });
      }catch(err){
        console.error(err);
        toast("‚ö†Ô∏è Unable to save picture. Please try again.", "warn", 3200);
      }
    }
  </script>
</body>
</html>
